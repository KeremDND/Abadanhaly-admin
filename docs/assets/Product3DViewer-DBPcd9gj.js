import{r as e,j as t,u as a,X as r,Z as s,v as n,w as o,x as i,y as c,E as l}from"./ui-CfJXJ_JQ.js";import{S as d,C as u,F as m,P as h,W as x,a as g,b as p,A as v,V as w,c as b,D as j,M as f,d as N,e as y,T as S,L as M}from"./three-BKtRV9Qt.js";import"./vendor-BxThA0WO.js";function R({productImage:R,productName:E,carpetSize:C,isOpen:k,onClose:L,autoRotate:D=!1,showControls:P=!0}){const I=e.useRef(null),z=e.useRef(),[T,A]=e.useState(!0),[Y,F]=e.useState(!1),[X,Z]=e.useState(50),[V,O]=e.useState(D),[W,H]=e.useState(!1),[U,$]=e.useState(0),q={minRadius:2,maxRadius:12,defaultRadius:6,defaultTheta:Math.PI/4,defaultPhi:Math.PI/3,rotationSpeed:.005,zoomSpeed:.1,autoRotateSpeed:.3},B=e.useCallback(()=>{if(!I.current||!k)return;$(10);const e=I.current.clientWidth,t=I.current.clientHeight,a=new d;a.background=new u(16317180),a.fog=new m(16317180,10,50);const r=new h(45,e/t,.1,100),s=new x({antialias:!0,alpha:!0,powerPreference:"high-performance"});s.setSize(e,t),s.setPixelRatio(Math.min(window.devicePixelRatio,2)),s.shadowMap.enabled=!0,s.shadowMap.type=g,s.outputColorSpace=p,s.toneMapping=v,s.toneMappingExposure=1.2,$(30),I.current.appendChild(s.domElement),$(50),G(a);const n={radius:q.defaultRadius,theta:q.defaultTheta,phi:q.defaultPhi,target:new w(0,0,0)},o={isDragging:!1,previousMouse:{x:0,y:0},cameraState:n};Q(r,n),z.current={scene:a,camera:r,renderer:s,controls:o,carpet:void 0,animationId:void 0},$(70),K(a,R,C),$(90),_(),ee(s.domElement),$(100),setTimeout(()=>A(!1),200)},[k,R,C]),G=e=>{const t=new b(16777215,.3);e.add(t);const a=new j(16777215,1.2);a.position.set(5,10,5),a.castShadow=!1,e.add(a),J(e)},J=e=>{const t=new f({color:16777215}),a=new N(20,20),r=new y(a,t);r.rotation.x=-Math.PI/2,r.position.y=-.01,r.receiveShadow=!1,e.add(r)},K=(e,t,a)=>{const r=new S;r.setCrossOrigin("anonymous"),r.load(t,t=>{t.colorSpace=p,t.generateMipmaps=!1,t.minFilter=M;const r=a.width/100,s=a.height/100,n=new N(r,s),o=new f({map:t}),i=new y(n,o);i.rotation.x=-Math.PI/2,i.position.set(0,.003,0),e.add(i),z.current&&(z.current.carpet=i)},e=>{if(e.total>0){const t=Math.round(e.loaded/e.total*100);$(70+.2*t)}},e=>{F(!0),A(!1)})},Q=(e,t)=>{const{radius:a,theta:r,phi:s,target:n}=t,o=a*Math.sin(s)*Math.cos(r),i=a*Math.cos(s),c=a*Math.sin(s)*Math.sin(r);e.position.set(o,i,c),e.lookAt(n);const l=Math.round((q.maxRadius-a)/(q.maxRadius-q.minRadius)*100);Z(l)},_=()=>{const e=()=>{if(!z.current)return;const{scene:t,camera:a,renderer:r,controls:s}=z.current;V&&!s.isDragging&&(s.cameraState.theta+=.01*q.autoRotateSpeed),Q(a,s.cameraState),r.render(t,a),z.current.animationId=requestAnimationFrame(e)};e()},ee=e=>{const t=e=>{z.current&&(z.current.controls.isDragging=!0,z.current.controls.previousMouse={x:e.clientX,y:e.clientY})},a=e=>{if(!z.current||!z.current.controls.isDragging)return;const{controls:t}=z.current,a=e.clientX-t.previousMouse.x,r=e.clientY-t.previousMouse.y;t.cameraState.theta+=a*q.rotationSpeed,t.cameraState.phi-=r*q.rotationSpeed,t.cameraState.phi=Math.max(.1,Math.min(Math.PI-.1,t.cameraState.phi)),t.previousMouse={x:e.clientX,y:e.clientY}},r=()=>{z.current&&(z.current.controls.isDragging=!1)},s=e=>{if(!z.current)return;e.preventDefault();const{controls:t}=z.current;t.cameraState.radius+=e.deltaY*q.zoomSpeed*.01,t.cameraState.radius=Math.max(q.minRadius,Math.min(q.maxRadius,t.cameraState.radius))},n=e=>{if(!z.current||1!==e.touches.length)return;const t=e.touches[0];z.current.controls.isDragging=!0,z.current.controls.previousMouse={x:t.clientX,y:t.clientY}},o=e=>{if(!z.current||!z.current.controls.isDragging||1!==e.touches.length)return;e.preventDefault();const t=e.touches[0],{controls:a}=z.current,r=t.clientX-a.previousMouse.x,s=t.clientY-a.previousMouse.y;a.cameraState.theta+=r*q.rotationSpeed,a.cameraState.phi-=s*q.rotationSpeed,a.cameraState.phi=Math.max(.1,Math.min(Math.PI-.1,a.cameraState.phi)),a.previousMouse={x:t.clientX,y:t.clientY}},i=()=>{z.current&&(z.current.controls.isDragging=!1)};return e.addEventListener("mousedown",t),window.addEventListener("mousemove",a),window.addEventListener("mouseup",r),e.addEventListener("wheel",s,{passive:!1}),e.addEventListener("touchstart",n,{passive:!1}),e.addEventListener("touchmove",o,{passive:!1}),e.addEventListener("touchend",i),()=>{e.removeEventListener("mousedown",t),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",r),e.removeEventListener("wheel",s),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",o),e.removeEventListener("touchend",i)}},te=e.useCallback(()=>{if(!z.current||!I.current)return;const{camera:e,renderer:t}=z.current,a=I.current.clientWidth,r=I.current.clientHeight;e.aspect=a/r,e.updateProjectionMatrix(),t.setSize(a,r)},[]);return e.useEffect(()=>(k&&(B(),window.addEventListener("resize",te)),()=>{z.current&&(z.current.animationId&&cancelAnimationFrame(z.current.animationId),I.current&&z.current.renderer.domElement&&I.current.removeChild(z.current.renderer.domElement),z.current.renderer.dispose(),z.current=void 0),window.removeEventListener("resize",te)}),[k,B,te]),k?t.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center",children:t.jsxs("div",{className:"w-full h-full max-w-7xl mx-4 my-4 bg-white rounded-2xl overflow-hidden shadow-2xl",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 bg-white",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[E," - 3D Room View"]}),t.jsxs("p",{className:"text-gray-600",children:[C.width," × ",C.height," cm"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[P&&t.jsx("button",{onClick:()=>H(!W),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Settings",children:t.jsx(a,{className:"w-5 h-5"})}),t.jsx("button",{onClick:L,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500",title:"Close","aria-label":"Close 3D viewer",children:t.jsx(r,{className:"w-6 h-6"})})]})]}),t.jsxs("div",{className:"relative flex-1",style:{height:"calc(100vh - 200px)"},children:[t.jsx("div",{ref:I,className:"w-full h-full"}),T&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-emerald-800 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 text-lg font-semibold",children:"Loading 3D Room"}),t.jsx("div",{className:"w-64 bg-gray-200 rounded-full h-2 mt-4 mx-auto",children:t.jsx("div",{className:"bg-emerald-800 h-2 rounded-full transition-all duration-300",style:{width:`${U}%`}})}),t.jsxs("p",{className:"text-gray-500 text-sm mt-2",children:[U,"% Complete"]})]})}),Y&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white",children:t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(r,{className:"w-8 h-8 text-red-600"})}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Failed to Load 3D View"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Unable to load the product image or 3D environment"}),t.jsx("button",{onClick:()=>{F(!1),A(!0),B()},className:"bg-emerald-800 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Try Again"})]})}),P&&!T&&!Y&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[t.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-2 shadow-lg flex gap-2",children:[t.jsx("button",{onClick:()=>{if(!z.current)return;const{controls:e}=z.current;e.cameraState.radius=Math.max(q.minRadius,e.cameraState.radius-.5)},className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Zoom In",children:t.jsx(s,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if(!z.current)return;const{controls:e}=z.current;e.cameraState.radius=Math.min(q.maxRadius,e.cameraState.radius+.5)},className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Zoom Out",children:t.jsx(n,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if(!z.current)return;const{controls:e}=z.current;e.cameraState.radius=q.defaultRadius,e.cameraState.theta=q.defaultTheta,e.cameraState.phi=q.defaultPhi},className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Reset View",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if(!z.current)return;const{renderer:e}=z.current,t=e.domElement,a=document.createElement("a");a.download=`${E.replace(/\s+/g,"-").toLowerCase()}-3d-view.png`,a.href=t.toDataURL("image/png"),a.click()},className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Take Screenshot",children:t.jsx(i,{className:"w-4 h-4"})})]}),t.jsx("button",{onClick:()=>O(!V),className:"p-2 rounded-lg shadow-lg transition-colors "+(V?"bg-emerald-800 text-white":"bg-white/90 backdrop-blur-sm hover:bg-gray-100"),title:"Toggle Auto Rotation",children:t.jsx(c,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"absolute bottom-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg p-3 shadow-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(l,{className:"w-4 h-4 text-gray-600"}),t.jsxs("span",{className:"text-gray-700",children:["Zoom: ",X,"%"]})]})}),t.jsxs("div",{className:"absolute bottom-4 left-4 bg-white/90 backdrop-blur-sm rounded-lg p-4 shadow-lg max-w-sm",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"3D Room Controls"}),t.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Drag:"})," Rotate around carpet"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Scroll:"})," Zoom in/out"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Touch:"})," Rotate on mobile"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Room view:"})," See carpet in living room"]})]})]})]}),W&&t.jsxs("div",{className:"absolute top-16 right-4 bg-white rounded-lg shadow-xl p-4 w-64",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"3D Room Settings"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm text-gray-700",children:"Auto Rotate"}),t.jsx("button",{onClick:()=>O(!V),className:"w-10 h-6 rounded-full transition-colors "+(V?"bg-emerald-800":"bg-gray-300"),children:t.jsx("div",{className:"w-4 h-4 bg-white rounded-full transition-transform "+(V?"translate-x-5":"translate-x-1")})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"Zoom Level"}),t.jsxs("div",{className:"text-lg font-semibold text-emerald-800",children:[X,"%"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"Product Size"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[C.width," × ",C.height," cm"]})]})]})]})]})]})}):null}export{R as default};
